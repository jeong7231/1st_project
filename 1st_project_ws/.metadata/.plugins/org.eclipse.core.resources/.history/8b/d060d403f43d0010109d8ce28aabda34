/*
 * mfrc522.h
 *
 *  Created on: May 31, 2025
 *      Author: aiot24_
 */

// =============================
// File: mfrc522.h
// =============================
#ifndef __MFRC522_H
#define __MFRC522_H

#include "stm32f4xx_hal.h"
#include <stdbool.h>

#define MFRC522_CS_PORT GPIOA
#define MFRC522_CS_PIN  GPIO_PIN_4
#define MFRC522_RST_PORT GPIOB
#define MFRC522_RST_PIN  GPIO_PIN_0

#define MAX_LEN 16

// MFRC522 Commands
#define PCD_IDLE        0x00
#define PCD_TRANSCEIVE  0x0C
#define PCD_RESETPHASE  0x0F
#define PCD_CALCCRC     0x03

// PICC Commands
#define PICC_REQIDL     0x26
#define PICC_ANTICOLL   0x93

// Status codes
#define MI_OK           0
#define MI_ERR          2

// Registers
#define CommandReg      0x01
#define CommIEnReg      0x02
#define CommIrqReg      0x04
#define ErrorReg        0x06
#define Status1Reg      0x07
#define Status2Reg      0x08
#define FIFODataReg     0x09
#define FIFOLevelReg    0x0A
#define ControlReg      0x0C
#define BitFramingReg   0x0D
#define ModeReg         0x11
#define TxControlReg    0x14
#define TxASKReg        0x15
#define TModeReg        0x2A
#define TPrescalerReg   0x2B
#define TReloadRegL     0x2D
#define TReloadRegH     0x2C
#define VersionReg      0x37

extern SPI_HandleTypeDef hspi1;

void MFRC522_Init(void);
uint8_t MFRC522_ReadReg(uint8_t addr);
void MFRC522_WriteReg(uint8_t addr, uint8_t val);
bool MFRC522_IsCard(void);
bool MFRC522_ReadCardSerial(uint8_t *uid);

#endif
